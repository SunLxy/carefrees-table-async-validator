(()=>{"use strict";var e,t,r,a,l,s,o={956(e,t,r){var a=r(2540),l=r(7470),s=r(6129),o=r(6023),i=r(1999),n=r(270),d=r(3696);class h{constructor(){var e=this;(0,s._)(this,"namespace",""),(0,s._)(this,"rowKey","rowId"),(0,s._)(this,"state",(0,o.BX)({})),(0,s._)(this,"errorState",(0,o.BX)({})),(0,s._)(this,"isCtor",!1),(0,s._)(this,"_o_dataList",[]),(0,s._)(this,"_last_dataList",[]),(0,s._)(this,"ctor",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e._last_dataList=[...t],e.isCtor)return t;let r=[];if(e._o_dataList=[...t],e._last_dataList=[],Array.isArray(t)){let a=[...t];for(;a.length;){let t=a.shift();t&&(e._last_dataList.push({[e.rowKey]:t[e.rowKey]}),r.push({[e.rowKey]:t[e.rowKey]}),e.state[t[e.rowKey]]={...t})}}return e.isCtor=!0,r}),(0,s._)(this,"onDeleteRow",()=>void 0),(0,s._)(this,"updatedRowData",function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];e.state[t]||(e.state[t]={});let l=Object.keys(r);for(let s=0;s<l.length;s++){let o=l[s];e.state[t][o]=r[o],a&&e.validate(e.state[t],[o],!1)}return e}),(0,s._)(this,"updatedRowDataAndValidate",(e,t,r)=>(this.updatedRowData(e,t,!1),this.validate(this.state[e],r,!1),this)),(0,s._)(this,"addRowData",e=>{let t=Date.now()+"_"+Math.random().toString(36).substring(2),r={[this.rowKey]:t,...e};return this.state[t]={...r},{rowId:t,_item:r}}),(0,s._)(this,"deleteRowData",e=>(delete this.state[e],delete this.errorState[e],this)),(0,s._)(this,"clear",e=>{if(e)this.state=(0,o.BX)({});else{let e=Object.keys(this.state);for(let t=0;t<e.length;t++){let r=e[t];delete this.state[r]}}return this.clearErrorInfo(e),this._o_dataList=[],this.isCtor=!1,this}),(0,s._)(this,"updatedErrorInfo",(e,t)=>{this.errorState[e]||(this.errorState[e]={});let r=Object.keys(t);for(let a=0;a<r.length;a++){let l=r[a];this.errorState[e][l]=t[l]}return this}),(0,s._)(this,"deleteErrorInfo",(e,t)=>{if(t&&this.errorState[e])if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];delete this.errorState[e][a]}else delete this.errorState[e][t];else delete this.errorState[e];return this}),(0,s._)(this,"clearErrorInfo",e=>{if(e)this.errorState=(0,o.BX)({});else{let e=Object.keys(this.errorState);for(let t=0;t<e.length;t++){let r=e[t];delete this.errorState[r]}}return this}),(0,s._)(this,"rules",{}),(0,s._)(this,"validate",async function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=r,s={},i=!1;(!r||Array.isArray(r)&&0===r.length)&&(l=Object.keys(e.rules));for(let r=0;r<l.length;r++){i=!0;let a=l[r],o=e.rules[a];if("function"==typeof o){let r=await o(t,e);s[a]=r}else Array.isArray(o)&&(s[a]=o)}return i?new Promise((r,i)=>{new n.A({...s}).validate({...t},(s,n)=>{let d=t[e.rowKey];e.errorState[d]||(e.errorState[d]={});for(let t=0;t<l.length;t++){let r=l[t],a=Array.isArray(s)?s.filter(e=>e.field===r):void 0;a?e.errorState[d][r]=(0,o.KR)(a.map(e=>e.message||"")):delete e.errorState[d][r]}a&&(s?i({errors:s,fields:n}):r(n))})}):(console.warn("no rules to validate"),Promise.resolve({...t}))}),(0,s._)(this,"validateAll",async e=>{let{rowKeys:t,fields:r,isReject:a=!0}=e,l=t;l=Array.isArray(t)&&t.length?t:Object.keys(this.state||{});let s=!1,o={},i=[];for(let e=0;e<l.length;e++){let t=l[e],a=this.state[t];try{await this.validate(a,r,!0),i.push(a)}catch(e){var n;s=!0,Array.isArray(null==e?void 0:e.errors)&&(null==e||null==(n=e.errors)?void 0:n.length)&&(null==e?void 0:e.fields)?o[t]=e:o[t]={otherError:e,fields:{},errors:[]}}}return s&&a?Promise.reject({errorInfo:o,dataList:i,isErrorInfo:s}):Promise.resolve({errorInfo:o,dataList:i,isErrorInfo:s})}),(0,s._)(this,"convertArrayToObject",e=>{let t={},r=[];for(let a=0;a<e.length;a++){let l=e[a],s=l[this.rowKey];t[s]={...l},r.push({[this.rowKey]:s})}return{data:t,list:r}})}}let u=(0,d.createContext)(new h);function c(){let e=(0,d.useContext)(u);return[(0,i.s)(e.state),(0,i.s)(e.errorState),e]}class f{constructor(){var e=this;(0,s._)(this,"childInstanceState",(0,o.BX)({})),(0,s._)(this,"register",(e,t)=>{this.childInstanceState[e]=(0,o.KR)(t)}),(0,s._)(this,"unRegister",e=>{delete this.childInstanceState[e]}),(0,s._)(this,"validate",async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{names:r,rowKey:a,fields:l,isReject:s=!0}=t,o=[],i=[],n=[],d={},h=r;(!r||Array.isArray(r)&&0===r.length)&&(h=Object.keys(e.childInstanceState));for(let t=0;t<h.length;t++){let r=h[t],s=e.childInstanceState[r];if(s){let e=await s.validateAll({rowKeys:a,fields:l,isReject:!1});e.isErrorInfo?i.push({...e,name:r}):(n.push({...e,name:r}),d[r]=e.dataList)}else o.push({name:r,message:`name: ${r.toString()} \u{672A}\u{67E5}\u{5230}\u{5B9E}\u{4F8B}\u{FF0C}\u{8BF7}\u{786E}\u{8BA4}\u{662F}\u{5426}\u{6CE8}\u{518C}`})}return s&&i.length?Promise.reject({nameToNotFound:o,nameToErrorInfo:i,nameToSuccessInfo:n,saveData:d}):Promise.resolve({nameToNotFound:o,nameToErrorInfo:i,nameToSuccessInfo:n,saveData:d})})}}let y=(0,d.createContext)(new f);var v=r(1649),g=r(5668),m=r(5188),w=r(8154),p=r(977),j=r(7355);let _=e=>{let{rowData:t}=e,r=(0,d.useContext)(u);return(0,a.jsx)(v.A,{title:"确认删除吗？",description:"删除后将无法恢复",onConfirm:()=>{r.onDeleteRow(t.rowId)},okText:"确认",cancelText:"取消",children:(0,a.jsx)(g.Ay,{danger:!0,children:"Delete"})})},x=e=>{var t,r;let{rowData:l,field:s}=e,[i,n,h]=c(),u=l.rowId,f=null==i||null==(t=i[u])?void 0:t[s],y=null==n||null==(r=n[u])?void 0:r[s],v=(0,d.useMemo)(()=>Array.isArray(y)&&y.length?(0,a.jsx)("div",{children:y.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[y]);return console.log(`${s} value: `,f),(0,a.jsx)(m.A,{open:!!v,title:v,color:"white",children:(0,a.jsx)("div",{className:v?"ant-form-item-has-error":"",children:(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>{let t=e.target.files;h.updatedRowData(u,{[s]:t?(0,o.KR)(t):void 0})}})})})},A=e=>{var t,r;let{rowData:l,field:s}=e,[o,i,n]=c(),h=l.rowId,u=null==o||null==(t=o[h])?void 0:t[s],f=null==i||null==(r=i[h])?void 0:r[s],y=(0,d.useMemo)(()=>Array.isArray(f)&&f.length?(0,a.jsx)("div",{children:f.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[f]);return(0,a.jsx)(m.A,{open:!!y,title:y,color:"white",children:(0,a.jsx)("div",{className:y?"ant-form-item-has-error":"",children:(0,a.jsx)(w.A,{className:y?"ant-input-status-error":"",placeholder:`请输入${s}`,value:u,onChange:e=>{n.updatedRowData(h,{[s]:e.target.value})}})})})},b=[{title:"删除",dataIndex:"delete",render:(e,t)=>(0,a.jsx)(_,{rowData:t})},{title:"姓名",dataIndex:"name",render:(e,t)=>(0,a.jsx)(A,{rowData:t,field:"name"})},{title:"年龄",dataIndex:"age",render:(e,t)=>(0,a.jsx)(A,{rowData:t,field:"age"})},{title:"文件",dataIndex:"file",render:(e,t)=>(0,a.jsx)(x,{rowData:t,field:"file"})}];function S(e){let t,r,l,{name:s,onChange:o,value:i}=e,{childInstance:n}=(t=(0,d.useContext)(y),(r=(0,d.useRef)()).current||(r.current=new h),(l=r.current).namespace=s,(0,d.useEffect)(()=>(t.register(s,l),()=>t.unRegister(s)),[s,l,t]),{childInstance:l,providerInstance:t});n.rowKey="rowId";let c=(0,d.useMemo)(()=>n.ctor(i),[n,i]);return(0,d.useMemo)(()=>{n.rules={name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}]}},[n]),n.onDeleteRow=e=>{n.deleteRowData(e),o&&o((null==c?void 0:c.filter(t=>t.rowId!==e))||[])},(0,d.useEffect)(()=>()=>{n.clear()},[]),(0,a.jsx)(u.Provider,{value:n,children:(0,a.jsxs)("div",{children:[(0,a.jsx)(p.A,{size:"small",rowKey:"rowId",columns:b,dataSource:c,pagination:!1}),(0,a.jsx)(g.Ay,{onClick:()=>{let e=n.addRowData({name:"",age:0});o&&o([...c||[]].concat([{rowId:e.rowId}]))},children:"新增一行"})]})})}let O={a:[{name:"d",age:0,rowId:"a1"}]},I=document.getElementById("root");I&&l.createRoot(I).render((0,a.jsx)(()=>{let e,t=((e=(0,d.useRef)()).current||(e.current=new f),e.current),[r]=j.A.useForm(),l=async()=>{try{let e=await r.validateFields();console.log("result",e)}catch(e){console.log("error",e)}try{let e=await t.validate();console.log("result",e)}catch(e){console.log("error",e)}};return(0,a.jsxs)(y.Provider,{value:t,children:[(0,a.jsxs)(j.A,{layout:"vertical",form:r,initialValues:O,children:[(0,a.jsx)(j.A.Item,{name:"1",label:"输入框1",rules:[{required:!0,message:"请输入"}],children:(0,a.jsx)(w.A,{})}),(0,a.jsx)(j.A.Item,{name:"a",label:"表格数据a",children:(0,a.jsx)(S,{name:"a"})}),(0,a.jsx)(j.A.Item,{name:"b",label:"表格数据b",children:(0,a.jsx)(S,{name:"b"})})]}),(0,a.jsx)(g.Ay,{type:"primary",onClick:l,children:"提交"})]})},{}))}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,n),r.exports}n.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(r,a){if(1&a&&(r=this(r)),8&a||"object"==typeof r&&r&&(4&a&&r.__esModule||16&a&&"function"==typeof r.then))return r;var l=Object.create(null);n.r(l);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>{s[e]=()=>r[e]});return s.default=()=>r,n.d(l,s),l},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r=[],n.O=(e,t,a,l)=>{if(t){l=l||0;for(var s=r.length;s>0&&r[s-1][2]>l;s--)r[s]=r[s-1];r[s]=[t,a,l];return}for(var o=1/0,s=0;s<r.length;s++){for(var[t,a,l]=r[s],i=!0,d=0;d<t.length;d++)(!1&l||o>=l)&&Object.keys(n.O).every(e=>n.O[e](t[d]))?t.splice(d--,1):(i=!1,l<o&&(o=l));if(i){r.splice(s--,1);var h=a();void 0!==h&&(e=h)}}return e},a={410:0},n.O.j=e=>0===a[e],l=(e,t)=>{var r,l,[s,o,i]=t,d=0;if(s.some(e=>0!==a[e])){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(i)var h=i(n)}for(e&&e(t);d<s.length;d++)l=s[d],n.o(a,l)&&a[l]&&a[l][0](),a[l]=0;return n.O(h)},(s=self.webpackChunkwebsite=self.webpackChunkwebsite||[]).forEach(l.bind(null,0)),s.push=l.bind(null,s.push.bind(s));var d=n.O(void 0,["783","792"],()=>n(956));d=n.O(d)})();