(()=>{"use strict";var e,t,r,a,l,s,o={956(e,t,r){var a=r(2540),l=r(3696),s=r(7470),o=r(6129),n=r(6023),i=r(1999),h=r(270);class d{constructor(){var e=this;(0,o._)(this,"namespace",""),(0,o._)(this,"rowKey","rowId"),(0,o._)(this,"state",(0,n.BX)({})),(0,o._)(this,"errorState",(0,n.BX)({})),(0,o._)(this,"onDeleteRow",()=>void 0),(0,o._)(this,"updatedRowData",function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];e.state[t]||(e.state[t]={});let l=Object.keys(r);for(let s=0;s<l.length;s++){let o=l[s];e.state[t][o]=r[o],a&&e.validate(e.state[t],[o],!1)}return e}),(0,o._)(this,"addRowData",e=>{let t=Date.now()+"_"+Math.random().toString(36).substring(2),r={[this.rowKey]:t,...e};return this.state[t]={...r},{rowId:t,_item:r}}),(0,o._)(this,"deleteRowData",e=>(delete this.state[e],delete this.errorState[e],this)),(0,o._)(this,"clear",e=>{if(e)this.state=(0,n.BX)({});else{let e=Object.keys(this.state);for(let t=0;t<e.length;t++){let r=e[t];delete this.state[r]}}return this}),(0,o._)(this,"updatedErrorInfo",(e,t)=>{this.errorState[e]||(this.errorState[e]={});let r=Object.keys(t);for(let a=0;a<r.length;a++){let l=r[a];this.errorState[e][l]=t[l]}return this}),(0,o._)(this,"deleteErrorInfo",(e,t)=>{if(t&&this.errorState[e])if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];delete this.errorState[e][a]}else delete this.errorState[e][t];else delete this.errorState[e];return this}),(0,o._)(this,"clearErrorInfo",e=>{if(e)this.errorState=(0,n.BX)({});else{let e=Object.keys(this.errorState);for(let t=0;t<e.length;t++){let r=e[t];delete this.errorState[r]}}return this}),(0,o._)(this,"rules",{}),(0,o._)(this,"validate",async function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=r,s={},o=!1;(!r||Array.isArray(r)&&0===r.length)&&(l=Object.keys(e.rules));for(let r=0;r<l.length;r++){o=!0;let a=l[r],n=e.rules[a];if("function"==typeof n){let r=await n(t,e);s[a]=r}else Array.isArray(n)&&(s[a]=n)}return o?new Promise((r,o)=>{new h.A({...s}).validate({...t},(s,n)=>{let i=t[e.rowKey];e.errorState[i]||(e.errorState[i]={});for(let t=0;t<l.length;t++){let r=l[t],a=Array.isArray(s)?s.filter(e=>e.field===r):void 0;a?e.errorState[i][r]=a.map(e=>e.message||""):delete e.errorState[i][r]}a&&(s?o({errors:s,fields:n}):r(n))})}):void console.warn("no rules to validate")}),(0,o._)(this,"validateAll",async e=>{let{rowKeys:t,fields:r,isReject:a=!0}=e,l=t;l=Array.isArray(t)&&t.length?t:Object.keys(this.state||{});let s=!1,o={},n=[];for(let e=0;e<l.length;e++){let t=l[e],a=this.state[t];try{await this.validate(a,r,!0),n.push(a)}catch(e){var i;s=!0,Array.isArray(null==e?void 0:e.errors)&&(null==e||null==(i=e.errors)?void 0:i.length)&&(null==e?void 0:e.fields)?o[t]=e:o[t]={otherError:e,fields:{},errors:[]}}}return s&&a?Promise.reject({errorInfo:o,dataList:n,isErrorInfo:s}):Promise.resolve({errorInfo:o,dataList:n,isErrorInfo:s})}),(0,o._)(this,"convertArrayToObject",e=>{let t={},r=[];for(let a=0;a<e.length;a++){let l=e[a],s=l[this.rowKey];t[s]={...l},r.push({[this.rowKey]:s})}return{data:t,list:r}}),(0,o._)(this,"ctorSaveState",e=>{let t=[];for(let r=0;r<e.length;r++){let a=e[r],l=a[this.rowKey];this.state[l]={...a},t.push({[this.rowKey]:l})}return t})}}let c=(0,l.createContext)(new d);class u{constructor(){var e=this;(0,o._)(this,"childInstanceState",(0,n.BX)({})),(0,o._)(this,"register",(e,t)=>{this.childInstanceState[e]=(0,n.KR)(t)}),(0,o._)(this,"unregister",e=>{delete this.childInstanceState[e]}),(0,o._)(this,"validate",async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{names:r,rowKey:a,fields:l,isReject:s=!0}=t,o=[],n=[],i=[],h=r;(!r||Array.isArray(r)&&0===r.length)&&(h=Object.keys(e.childInstanceState));for(let t=0;t<h.length;t++){let r=h[t],s=e.childInstanceState[r];if(s){let e=await s.validateAll({rowKeys:a,fields:l,isReject:!1});e.isErrorInfo?n.push({...e,name:r}):i.push({...e,name:r})}else o.push({name:r,message:`name: ${r.toString()} \u{672A}\u{67E5}\u{5230}\u{5B9E}\u{4F8B}\u{FF0C}\u{8BF7}\u{786E}\u{8BA4}\u{662F}\u{5426}\u{6CE8}\u{518C}`})}return s&&n.length?Promise.reject({nameToNotFound:o,nameToErrorInfo:n,nameToSuccessInfo:i}):Promise.resolve({nameToNotFound:o,nameToErrorInfo:n,nameToSuccessInfo:i})})}}let f=(0,l.createContext)(new u);var y=r(1649),v=r(5668),g=r(5188),m=r(8154),j=r(2094),w=r(7355);let p=e=>{let{rowData:t}=e,r=(0,l.useContext)(c);return(0,a.jsx)(y.A,{title:"确认删除吗？",description:"删除后将无法恢复",onConfirm:()=>{r.onDeleteRow(t.rowId)},okText:"确认",cancelText:"取消",children:(0,a.jsx)(v.Ay,{danger:!0,children:"Delete"})})},x=e=>{var t,r;let s,{rowData:o,field:n}=e,[h,d,u]=(s=(0,l.useContext)(c),[(0,i.s)(s.state),(0,i.s)(s.errorState),s]),f=o.rowId,y=null==h||null==(t=h[f])?void 0:t[n],v=null==d||null==(r=d[f])?void 0:r[n],j=(0,l.useMemo)(()=>Array.isArray(v)&&v.length?(0,a.jsx)("div",{children:v.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[v]);return(0,a.jsx)(g.A,{open:!!j,title:j,color:"white",children:(0,a.jsx)("div",{className:j?"ant-form-item-has-error":"",children:(0,a.jsx)(m.A,{className:j?"ant-input-status-error":"",placeholder:`请输入${n}`,value:y,onChange:e=>{u.updatedRowData(f,{[n]:e.target.value})}})})})},b=[{title:"删除",dataIndex:"delete",render:(e,t)=>(0,a.jsx)(p,{rowData:t})},{title:"姓名",dataIndex:"name",render:(e,t)=>(0,a.jsx)(x,{rowData:t,field:"name"})},{title:"年龄",dataIndex:"age",render:(e,t)=>(0,a.jsx)(x,{rowData:t,field:"age"})}];function A(e){let t,r,s,{name:o,onChange:n,value:i}=e,{childInstance:h}=(t=(0,l.useContext)(f),(r=(0,l.useRef)()).current||(r.current=new d),(s=r.current).namespace=o,(0,l.useEffect)(()=>(t.register(o,s),()=>t.unregister(o)),[o,s,t]),{childInstance:s,providerInstance:t});return h.rowKey="rowId",(0,l.useMemo)(()=>{h.rules={name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}]}},[h]),h.onDeleteRow=e=>{h.deleteRowData(e),n&&n((null==i?void 0:i.filter(t=>t.rowId!==e))||[])},(0,a.jsx)(c.Provider,{value:h,children:(0,a.jsxs)("div",{children:[(0,a.jsx)(j.A,{size:"small",rowKey:"rowId",columns:b,dataSource:i,pagination:!1}),(0,a.jsx)(v.Ay,{onClick:()=>{let e=h.addRowData({name:"",age:0});n&&n([...i||[]].concat([e._item]))},children:"新增一行"})]})})}let S=document.getElementById("root");S&&s.createRoot(S).render((0,a.jsx)(l.StrictMode,{children:(0,a.jsx)(()=>{let e,t=((e=(0,l.useRef)()).current||(e.current=new u),e.current),[r]=w.A.useForm(),s=async()=>{try{let e=await r.validateFields();console.log("result",e)}catch(e){console.log("error",e)}try{let e=await t.validate();console.log("result",e)}catch(e){console.log("error",e)}};return(0,a.jsxs)(f.Provider,{value:t,children:[(0,a.jsxs)(w.A,{form:r,children:[(0,a.jsx)(w.A.Item,{name:"1",label:"1",rules:[{required:!0,message:"请输入"}],children:(0,a.jsx)(m.A,{})}),(0,a.jsx)(w.A.Item,{name:"a",label:"a",children:(0,a.jsx)(A,{name:"a"})}),(0,a.jsx)(w.A.Item,{name:"b",label:"b",children:(0,a.jsx)(A,{name:"b"})})]}),(0,a.jsx)(v.Ay,{type:"primary",onClick:s,children:"提交"})]})},{})}))}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return o[e](r,r.exports,i),r.exports}i.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(r,a){if(1&a&&(r=this(r)),8&a||"object"==typeof r&&r&&(4&a&&r.__esModule||16&a&&"function"==typeof r.then))return r;var l=Object.create(null);i.r(l);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>{s[e]=()=>r[e]});return s.default=()=>r,i.d(l,s),l},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r=[],i.O=(e,t,a,l)=>{if(t){l=l||0;for(var s=r.length;s>0&&r[s-1][2]>l;s--)r[s]=r[s-1];r[s]=[t,a,l];return}for(var o=1/0,s=0;s<r.length;s++){for(var[t,a,l]=r[s],n=!0,h=0;h<t.length;h++)(!1&l||o>=l)&&Object.keys(i.O).every(e=>i.O[e](t[h]))?t.splice(h--,1):(n=!1,l<o&&(o=l));if(n){r.splice(s--,1);var d=a();void 0!==d&&(e=d)}}return e},a={410:0},i.O.j=e=>0===a[e],l=(e,t)=>{var r,l,[s,o,n]=t,h=0;if(s.some(e=>0!==a[e])){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(n)var d=n(i)}for(e&&e(t);h<s.length;h++)l=s[h],i.o(a,l)&&a[l]&&a[l][0](),a[l]=0;return i.O(d)},(s=self.webpackChunkwebsite=self.webpackChunkwebsite||[]).forEach(l.bind(null,0)),s.push=l.bind(null,s.push.bind(s));var h=i.O(void 0,["783","529"],()=>i(956));h=i.O(h)})();