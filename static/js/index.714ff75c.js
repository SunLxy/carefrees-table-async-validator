(()=>{"use strict";var e,t,r,a,s,l,o={956(e,t,r){var a=r(2540),s=r(3696),l=r(7470),o=r(6129),i=r(6023),n=r(1999),d=r(270);class h{constructor(){var e=this;(0,o._)(this,"namespace",""),(0,o._)(this,"rowKey","rowId"),(0,o._)(this,"state",(0,i.BX)({})),(0,o._)(this,"errorState",(0,i.BX)({})),(0,o._)(this,"isCtor",!1),(0,o._)(this,"_o_dataList",[]),(0,o._)(this,"_last_dataList",[]),(0,o._)(this,"ctor",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e._last_dataList=[...t],e.isCtor)return t;let r=[];if(e._o_dataList=[...t],e._last_dataList=[],Array.isArray(t)){let a=[...t];for(;a.length;){let t=a.shift();t&&(e._last_dataList.push({[e.rowKey]:t[e.rowKey]}),r.push({[e.rowKey]:t[e.rowKey]}),e.state[t[e.rowKey]]={...t})}}return e.isCtor=!0,r}),(0,o._)(this,"onDeleteRow",()=>void 0),(0,o._)(this,"updatedRowData",function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];e.state[t]||(e.state[t]={});let s=Object.keys(r);for(let l=0;l<s.length;l++){let o=s[l];e.state[t][o]=r[o],a&&e.validate(e.state[t],[o],!1)}return e}),(0,o._)(this,"addRowData",e=>{let t=Date.now()+"_"+Math.random().toString(36).substring(2),r={[this.rowKey]:t,...e};return this.state[t]={...r},{rowId:t,_item:r}}),(0,o._)(this,"deleteRowData",e=>(delete this.state[e],delete this.errorState[e],this)),(0,o._)(this,"clear",e=>{if(e)this.state=(0,i.BX)({});else{let e=Object.keys(this.state);for(let t=0;t<e.length;t++){let r=e[t];delete this.state[r]}}return this.clearErrorInfo(e),this._o_dataList=[],this.isCtor=!1,this}),(0,o._)(this,"updatedErrorInfo",(e,t)=>{this.errorState[e]||(this.errorState[e]={});let r=Object.keys(t);for(let a=0;a<r.length;a++){let s=r[a];this.errorState[e][s]=t[s]}return this}),(0,o._)(this,"deleteErrorInfo",(e,t)=>{if(t&&this.errorState[e])if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];delete this.errorState[e][a]}else delete this.errorState[e][t];else delete this.errorState[e];return this}),(0,o._)(this,"clearErrorInfo",e=>{if(e)this.errorState=(0,i.BX)({});else{let e=Object.keys(this.errorState);for(let t=0;t<e.length;t++){let r=e[t];delete this.errorState[r]}}return this}),(0,o._)(this,"rules",{}),(0,o._)(this,"validate",async function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=r,l={},o=!1;(!r||Array.isArray(r)&&0===r.length)&&(s=Object.keys(e.rules));for(let r=0;r<s.length;r++){o=!0;let a=s[r],i=e.rules[a];if("function"==typeof i){let r=await i(t,e);l[a]=r}else Array.isArray(i)&&(l[a]=i)}return o?new Promise((r,o)=>{new d.A({...l}).validate({...t},(l,i)=>{let n=t[e.rowKey];e.errorState[n]||(e.errorState[n]={});for(let t=0;t<s.length;t++){let r=s[t],a=Array.isArray(l)?l.filter(e=>e.field===r):void 0;a?e.errorState[n][r]=a.map(e=>e.message||""):delete e.errorState[n][r]}a&&(l?o({errors:l,fields:i}):r(i))})}):void console.warn("no rules to validate")}),(0,o._)(this,"validateAll",async e=>{let{rowKeys:t,fields:r,isReject:a=!0}=e,s=t;s=Array.isArray(t)&&t.length?t:Object.keys(this.state||{});let l=!1,o={},i=[];for(let e=0;e<s.length;e++){let t=s[e],a=this.state[t];try{await this.validate(a,r,!0),i.push(a)}catch(e){var n;l=!0,Array.isArray(null==e?void 0:e.errors)&&(null==e||null==(n=e.errors)?void 0:n.length)&&(null==e?void 0:e.fields)?o[t]=e:o[t]={otherError:e,fields:{},errors:[]}}}return l&&a?Promise.reject({errorInfo:o,dataList:i,isErrorInfo:l}):Promise.resolve({errorInfo:o,dataList:i,isErrorInfo:l})}),(0,o._)(this,"convertArrayToObject",e=>{let t={},r=[];for(let a=0;a<e.length;a++){let s=e[a],l=s[this.rowKey];t[l]={...s},r.push({[this.rowKey]:l})}return{data:t,list:r}})}}let u=(0,s.createContext)(new h);class c{constructor(){var e=this;(0,o._)(this,"childInstanceState",(0,i.BX)({})),(0,o._)(this,"register",(e,t)=>{this.childInstanceState[e]=(0,i.KR)(t)}),(0,o._)(this,"unregister",e=>{delete this.childInstanceState[e]}),(0,o._)(this,"validate",async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{names:r,rowKey:a,fields:s,isReject:l=!0}=t,o=[],i=[],n=[],d=r;(!r||Array.isArray(r)&&0===r.length)&&(d=Object.keys(e.childInstanceState));for(let t=0;t<d.length;t++){let r=d[t],l=e.childInstanceState[r];if(l){let e=await l.validateAll({rowKeys:a,fields:s,isReject:!1});e.isErrorInfo?i.push({...e,name:r}):n.push({...e,name:r})}else o.push({name:r,message:`name: ${r.toString()} \u{672A}\u{67E5}\u{5230}\u{5B9E}\u{4F8B}\u{FF0C}\u{8BF7}\u{786E}\u{8BA4}\u{662F}\u{5426}\u{6CE8}\u{518C}`})}return l&&i.length?Promise.reject({nameToNotFound:o,nameToErrorInfo:i,nameToSuccessInfo:n}):Promise.resolve({nameToNotFound:o,nameToErrorInfo:i,nameToSuccessInfo:n})})}}let f=(0,s.createContext)(new c);var y=r(1649),v=r(5668),g=r(5188),m=r(8154),w=r(2094),j=r(7355);let p=e=>{let{rowData:t}=e,r=(0,s.useContext)(u);return(0,a.jsx)(y.A,{title:"确认删除吗？",description:"删除后将无法恢复",onConfirm:()=>{r.onDeleteRow(t.rowId)},okText:"确认",cancelText:"取消",children:(0,a.jsx)(v.Ay,{danger:!0,children:"Delete"})})},_=e=>{var t,r;let l,{rowData:o,field:i}=e,[d,h,c]=(l=(0,s.useContext)(u),[(0,n.s)(l.state),(0,n.s)(l.errorState),l]),f=o.rowId,y=null==d||null==(t=d[f])?void 0:t[i],v=null==h||null==(r=h[f])?void 0:r[i],w=(0,s.useMemo)(()=>Array.isArray(v)&&v.length?(0,a.jsx)("div",{children:v.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[v]);return(0,a.jsx)(g.A,{open:!!w,title:w,color:"white",children:(0,a.jsx)("div",{className:w?"ant-form-item-has-error":"",children:(0,a.jsx)(m.A,{className:w?"ant-input-status-error":"",placeholder:`请输入${i}`,value:y,onChange:e=>{c.updatedRowData(f,{[i]:e.target.value})}})})})},x=[{title:"删除",dataIndex:"delete",render:(e,t)=>(0,a.jsx)(p,{rowData:t})},{title:"姓名",dataIndex:"name",render:(e,t)=>(0,a.jsx)(_,{rowData:t,field:"name"})},{title:"年龄",dataIndex:"age",render:(e,t)=>(0,a.jsx)(_,{rowData:t,field:"age"})}];function b(e){let t,r,l,{name:o,onChange:i,value:n}=e,{childInstance:d}=(t=(0,s.useContext)(f),(r=(0,s.useRef)()).current||(r.current=new h),(l=r.current).namespace=o,(0,s.useEffect)(()=>(t.register(o,l),()=>t.unregister(o)),[o,l,t]),{childInstance:l,providerInstance:t});d.rowKey="rowId";let c=(0,s.useMemo)(()=>d.ctor(n),[d,n]);return(0,s.useMemo)(()=>{d.rules={name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}]}},[d]),d.onDeleteRow=e=>{d.deleteRowData(e),i&&i((null==c?void 0:c.filter(t=>t.rowId!==e))||[])},(0,s.useEffect)(()=>()=>{d.clear()},[]),(0,a.jsx)(u.Provider,{value:d,children:(0,a.jsxs)("div",{children:[(0,a.jsx)(w.A,{size:"small",rowKey:"rowId",columns:x,dataSource:c,pagination:!1}),(0,a.jsx)(v.Ay,{onClick:()=>{let e=d.addRowData({name:"",age:0});i&&i([...c||[]].concat([{rowId:e.rowId}]))},children:"新增一行"})]})})}let A={a:[{name:"d",age:0,rowId:"a1"}]},S=document.getElementById("root");S&&l.createRoot(S).render((0,a.jsx)(s.StrictMode,{children:(0,a.jsx)(()=>{let e,t=((e=(0,s.useRef)()).current||(e.current=new c),e.current),[r]=j.A.useForm(),l=async()=>{try{let e=await r.validateFields();console.log("result",e)}catch(e){console.log("error",e)}try{let e=await t.validate();console.log("result",e)}catch(e){console.log("error",e)}};return(0,a.jsxs)(f.Provider,{value:t,children:[(0,a.jsxs)(j.A,{layout:"vertical",form:r,initialValues:A,children:[(0,a.jsx)(j.A.Item,{name:"1",label:"输入框1",rules:[{required:!0,message:"请输入"}],children:(0,a.jsx)(m.A,{})}),(0,a.jsx)(j.A.Item,{name:"a",label:"表格数据a",children:(0,a.jsx)(b,{name:"a"})}),(0,a.jsx)(j.A.Item,{name:"b",label:"表格数据b",children:(0,a.jsx)(b,{name:"b"})})]}),(0,a.jsx)(v.Ay,{type:"primary",onClick:l,children:"提交"})]})},{})}))}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,n),r.exports}n.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(r,a){if(1&a&&(r=this(r)),8&a||"object"==typeof r&&r&&(4&a&&r.__esModule||16&a&&"function"==typeof r.then))return r;var s=Object.create(null);n.r(s);var l={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>{l[e]=()=>r[e]});return l.default=()=>r,n.d(s,l),s},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r=[],n.O=(e,t,a,s)=>{if(t){s=s||0;for(var l=r.length;l>0&&r[l-1][2]>s;l--)r[l]=r[l-1];r[l]=[t,a,s];return}for(var o=1/0,l=0;l<r.length;l++){for(var[t,a,s]=r[l],i=!0,d=0;d<t.length;d++)(!1&s||o>=s)&&Object.keys(n.O).every(e=>n.O[e](t[d]))?t.splice(d--,1):(i=!1,s<o&&(o=s));if(i){r.splice(l--,1);var h=a();void 0!==h&&(e=h)}}return e},a={410:0},n.O.j=e=>0===a[e],s=(e,t)=>{var r,s,[l,o,i]=t,d=0;if(l.some(e=>0!==a[e])){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(i)var h=i(n)}for(e&&e(t);d<l.length;d++)s=l[d],n.o(a,s)&&a[s]&&a[s][0](),a[s]=0;return n.O(h)},(l=self.webpackChunkwebsite=self.webpackChunkwebsite||[]).forEach(s.bind(null,0)),l.push=s.bind(null,l.push.bind(l));var d=n.O(void 0,["783","529"],()=>n(956));d=n.O(d)})();