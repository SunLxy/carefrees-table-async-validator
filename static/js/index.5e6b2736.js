(()=>{"use strict";var e,t,r,a,i,s,o={956(e,t,r){var a=r(2540),i=r(7470),s=r(6129),o=r(6023),l=r(1999),n=r(270),h=r(3696),d=r(7063);class u{constructor(){var e=this;(0,s._)(this,"namespace",""),(0,s._)(this,"rowKey","rowId"),(0,s._)(this,"enableOperationState",!1),(0,s._)(this,"state",(0,o.BX)({})),(0,s._)(this,"errorState",(0,o.BX)({})),(0,s._)(this,"operationState",(0,o.BX)({})),(0,s._)(this,"tempState",(0,o.BX)({})),(0,s._)(this,"isCtor",!1),(0,s._)(this,"_o_dataList",[]),(0,s._)(this,"_last_dataList",[]),(0,s._)(this,"ctor",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e._last_dataList=[...t],e.isCtor)return t;let r=[];if(e._o_dataList=(0,d.C)(t),e._last_dataList=[],Array.isArray(t)){let a=[...t];for(;a.length;){let t=a.shift();t&&(e._last_dataList.push({[e.rowKey]:t[e.rowKey]}),r.push({[e.rowKey]:t[e.rowKey]}),e.state[t[e.rowKey]]=(0,d.C)({...t}))}}return e.isCtor=!0,r}),(0,s._)(this,"onChangeRows",()=>void 0),(0,s._)(this,"updatedRowData",function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];e.state[t]||(e.state[t]={});let i=Object.keys(r);for(let s=0;s<i.length;s++){let o=i[s];e.state[t][o]=r[o],a&&e.validate(e.state[t],[o],!1)}return e}),(0,s._)(this,"updatedRowDataAndValidate",(e,t,r)=>(this.updatedRowData(e,t,!1),this.validate(this.state[e],r,!1),this)),(0,s._)(this,"addRowData",e=>{let t=Date.now()+"_"+Math.random().toString(36).substring(2),r={[this.rowKey]:t,...e};return this.state[t]={...r},{rowId:t,_item:r}}),(0,s._)(this,"deleteRowData",e=>(delete this.state[e],delete this.errorState[e],this)),(0,s._)(this,"clear",e=>{if(e)this.state=(0,o.BX)({});else{let e=Object.keys(this.state);for(let t=0;t<e.length;t++){let r=e[t];delete this.state[r]}}return this.clearErrorInfo(e),this._o_dataList=[],this.isCtor=!1,this}),(0,s._)(this,"updatedErrorInfo",(e,t)=>{this.errorState[e]||(this.errorState[e]={});let r=Object.keys(t);for(let a=0;a<r.length;a++){let i=r[a];this.errorState[e][i]=t[i]}return this}),(0,s._)(this,"deleteErrorInfo",(e,t)=>{if(t&&this.errorState[e])if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];delete this.errorState[e][a]}else delete this.errorState[e][t];else delete this.errorState[e];return this}),(0,s._)(this,"clearErrorInfo",e=>{if(e)this.errorState=(0,o.BX)({});else{let e=Object.keys(this.errorState);for(let t=0;t<e.length;t++){let r=e[t];delete this.errorState[r]}}return this}),(0,s._)(this,"updatedOperationState",(e,t)=>{if(Array.isArray(e))for(let r=0;r<e.length;r++){let a=e[r];this.operationState[a]=t}else this.operationState[e]=t;return this}),(0,s._)(this,"removeOperationState",e=>{if(Array.isArray(e))for(let t=0;t<e.length;t++){let r=e[t];delete this.operationState[r]}else delete this.operationState[e];return this}),(0,s._)(this,"isExistOperationState",e=>{let t=[],r=[];return Array.isArray(e)&&e.length?(t=(null==e?void 0:e.filter(e=>"edit"===this.operationState[e]))||[],r=(null==e?void 0:e.filter(e=>"add"===this.operationState[e]))||[]):(t=Object.keys(this.operationState||[]).filter(e=>"edit"===this.operationState[e])||[],r=Object.keys(this.operationState||[]).filter(e=>"add"===this.operationState[e])||[]),{editKeys:t,addKeys:r,isExist:t.length>0||r.length>0}}),(0,s._)(this,"updatedTempState",(e,t)=>(this.tempState[e]=(0,o.KR)((0,d.C)(t)),this)),(0,s._)(this,"removeTempState",e=>(delete this.tempState[e],this)),(0,s._)(this,"getTempState",e=>this.tempState[e]),(0,s._)(this,"onCancelRowOperation",e=>{let t=this.getTempState(e);t&&(this.state[e]=(0,d.C)({...t}));let r=this.operationState[e];if(this.removeOperationState(e),this.removeTempState(e),this.deleteErrorInfo(e),"add"===r){var a;let t=[...this._last_dataList].filter(t=>t[this.rowKey]!==e);null==(a=this.onChangeRows)||a.call(this,t,e,"delete")}return this}),(0,s._)(this,"onClickEditRowOperation",e=>(this.updatedTempState(e,this.state[e]),this.updatedOperationState(e,"edit"),this)),(0,s._)(this,"onClickAddRowOperation",e=>{var t;let{rowId:r}=this.addRowData(e),a=[...this._last_dataList].concat([{[this.rowKey]:r}]);return this.updatedOperationState(r,"add"),null==(t=this.onChangeRows)||t.call(this,a,r,"add"),this}),(0,s._)(this,"onClickSaveRowOperation",async function(t){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=!0;try{await e.validate(e.state[t])&&(a=!0,e.deleteErrorInfo(t),e.removeTempState(t),e.removeOperationState(t))}catch(e){if(a=!1,r)throw e}return Promise.resolve(a)}),(0,s._)(this,"onClickDeleteRowOperation",e=>{var t;let r=[...this._last_dataList].filter(t=>t[this.rowKey]!==e);return null==(t=this.onChangeRows)||t.call(this,r,e,"delete"),this.deleteRowData(e),this.deleteErrorInfo(e),this.removeOperationState(e),this.removeTempState(e),this}),(0,s._)(this,"rules",{}),(0,s._)(this,"validate",async function(t,r){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=r,s={},l=!1;(!r||Array.isArray(r)&&0===r.length)&&(i=Object.keys(e.rules));for(let r=0;r<i.length;r++){l=!0;let a=i[r],o=e.rules[a];if("function"==typeof o){let r=await o(t,e);s[a]=r}else Array.isArray(o)&&(s[a]=o)}return l?new Promise((r,l)=>{new n.A({...s}).validate({...t},(s,n)=>{let h=t[e.rowKey];e.errorState[h]||(e.errorState[h]={});for(let t=0;t<i.length;t++){let r=i[t],a=Array.isArray(s)?s.filter(e=>e.field===r):void 0;a?e.errorState[h][r]=(0,o.KR)(a.map(e=>e.message||"")):delete e.errorState[h][r]}a&&(s?l({errors:s,fields:n}):r(n))})}):(console.warn("no rules to validate"),Promise.resolve({...t}))}),(0,s._)(this,"validateAll",async e=>{let{rowKeys:t,fields:r,isReject:a=!0,isHasOperationRow:i=!1}=e;if(i&&this.enableOperationState&&this.isExistOperationState())return Promise.reject({errorInfo:{},dataList:[],isErrorInfo:!1,isHasOperationRow:!0});let s=t;s=Array.isArray(t)&&t.length?t:Object.keys(this.state||{});let o=!1,l={},n=[];for(let e=0;e<s.length;e++){let t=s[e],a=this.state[t];try{await this.validate(a,r,!0),n.push(a)}catch(e){var h;o=!0,Array.isArray(null==e?void 0:e.errors)&&(null==e||null==(h=e.errors)?void 0:h.length)&&(null==e?void 0:e.fields)?l[t]=e:l[t]={otherError:e,fields:{},errors:[]}}}return o&&a?Promise.reject({errorInfo:l,dataList:n,isErrorInfo:o}):Promise.resolve({errorInfo:l,dataList:n,isErrorInfo:o})}),(0,s._)(this,"convertArrayToObject",e=>{let t={},r=[];for(let a=0;a<e.length;a++){let i=e[a],s=i[this.rowKey];t[s]=(0,d.C)({...i}),r.push({[this.rowKey]:s})}return{data:t,list:r}})}}let c=(0,h.createContext)(new u);function f(e){let t=(0,h.useContext)(c),r=(0,l.s)(t.state,e),a=(0,l.s)(t.errorState),i=(0,l.s)(t.operationState);return[r,a,i,t,r.__defaultValue,a.__defaultValue,i.__defaultValue]}class p{constructor(){var e=this;(0,s._)(this,"childInstanceState",(0,o.BX)({})),(0,s._)(this,"register",(e,t)=>{this.childInstanceState[e]=(0,o.KR)(t)}),(0,s._)(this,"unRegister",e=>{delete this.childInstanceState[e]}),(0,s._)(this,"hasOperationRow",()=>{let e=!1;for(let t in this.childInstanceState){let r=this.childInstanceState[t];if(r&&r.enableOperationState&&r.isExistOperationState().isExist){e=!0;break}}return e}),(0,s._)(this,"validate",async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{names:r,rowKey:a,fields:i,isReject:s=!0,isHasOperationRow:o=!1}=t;if(o&&e.hasOperationRow())return Promise.reject({nameToNotFound:[],nameToErrorInfo:[],nameToSuccessInfo:[],saveData:{},isHasOperationRow:!0});let l=[],n=[],h=[],d={},u=r;(!r||Array.isArray(r)&&0===r.length)&&(u=Object.keys(e.childInstanceState));for(let t=0;t<u.length;t++){let r=u[t],s=e.childInstanceState[r];if(s){let e=await s.validateAll({rowKeys:a,fields:i,isReject:!1});e.isErrorInfo?n.push({...e,name:r}):(h.push({...e,name:r}),d[r]=e.dataList)}else l.push({name:r,message:`name: ${r.toString()} \u{672A}\u{67E5}\u{5230}\u{5B9E}\u{4F8B}\u{FF0C}\u{8BF7}\u{786E}\u{8BA4}\u{662F}\u{5426}\u{6CE8}\u{518C}`})}return s&&n.length?Promise.reject({nameToNotFound:l,nameToErrorInfo:n,nameToSuccessInfo:h,saveData:d}):Promise.resolve({nameToNotFound:l,nameToErrorInfo:n,nameToSuccessInfo:h,saveData:d})})}}let v=(0,h.createContext)(new p);var y=r(1649),m=r(5668),w=r(5188),g=r(8154),_=r(977),S=r(7355);let j=e=>{let{rowData:t}=e,r=(0,h.useContext)(c);return(0,a.jsx)(y.A,{title:"确认删除吗？",description:"删除后将无法恢复",onConfirm:()=>{r.onClickDeleteRowOperation(t.rowId)},okText:"确认",cancelText:"取消",children:(0,a.jsx)(m.Ay,{danger:!0,children:"Delete"})})},O=e=>{var t,r;let{rowData:i,field:s}=e,[l,n,d,u]=f(),c=i.rowId,p=null==l||null==(t=l[c])?void 0:t[s],v=null==n||null==(r=n[c])?void 0:r[s],y=(0,h.useMemo)(()=>Array.isArray(v)&&v.length?(0,a.jsx)("div",{children:v.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[v]);return console.log(`${s} value: `,p),(0,a.jsx)(w.A,{open:!!y,title:y,color:"white",children:(0,a.jsx)("div",{className:y?"ant-form-item-has-error":"",children:(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>{let t=e.target.files;u.updatedRowData(c,{[s]:t?(0,o.KR)(t):void 0})}})})})},x=e=>{var t,r;let{rowData:i,field:s}=e,[o,l,n,d]=f(),u=i.rowId,c=null==o||null==(t=o[u])?void 0:t[s],p=null==l||null==(r=l[u])?void 0:r[s],v=(0,h.useMemo)(()=>Array.isArray(p)&&p.length?(0,a.jsx)("div",{children:p.map((e,t)=>(0,a.jsx)("div",{style:{color:"red"},children:e},t))}):"",[p]);return(0,a.jsx)(w.A,{open:!!v,title:v,color:"white",children:(0,a.jsx)("div",{className:v?"ant-form-item-has-error":"",children:(0,a.jsx)(g.A,{className:v?"ant-input-status-error":"",placeholder:`请输入${s}`,value:c,onChange:e=>{d.updatedRowData(u,{[s]:e.target.value})}})})})},A=[{title:"删除",dataIndex:"delete",render:(e,t)=>(0,a.jsx)(j,{rowData:t})},{title:"姓名",dataIndex:"name",render:(e,t)=>(0,a.jsx)(x,{rowData:t,field:"name"})},{title:"年龄",dataIndex:"age",render:(e,t)=>(0,a.jsx)(x,{rowData:t,field:"age"})},{title:"文件",dataIndex:"file",render:(e,t)=>(0,a.jsx)(O,{rowData:t,field:"file"})}];function b(e){var t;let r,i,s,{name:o,onChange:l,value:n}=e,{childInstance:d}=(r=(0,h.useContext)(v),t=void 0,(i=(0,h.useRef)()).current||(t?i.current=t:i.current=new u),(s=i.current).namespace=o,(0,h.useEffect)(()=>(r.register(o,s),()=>r.unRegister(o)),[o,s,r]),{childInstance:s,providerInstance:r});d.rowKey="rowId";let f=(0,h.useMemo)(()=>d.ctor(n),[d,n]);return(0,h.useMemo)(()=>{d.rules={name:[{required:!0,message:"请输入姓名"}],age:[{required:!0,message:"请输入年龄"}]}},[d]),d.onChangeRows=e=>{l&&l(e)},(0,h.useEffect)(()=>()=>{d.clear()},[]),(0,a.jsx)(c.Provider,{value:d,children:(0,a.jsxs)("div",{children:[(0,a.jsx)(_.A,{size:"small",rowKey:"rowId",columns:A,dataSource:f,pagination:!1}),(0,a.jsx)(m.Ay,{onClick:()=>{let e=d.addRowData({name:"",age:0});l&&l([...f||[]].concat([{rowId:e.rowId}]))},children:"新增一行"})]})})}let I={a:[{name:"d",age:0,rowId:"a1"}]},C=document.getElementById("root");C&&i.createRoot(C).render((0,a.jsx)(()=>{let e,t=((e=(0,h.useRef)()).current||(e.current=new p),e.current),[r]=S.A.useForm(),i=async()=>{try{let e=await r.validateFields();console.log("result",e)}catch(e){console.log("error",e)}try{let e=await t.validate();console.log("result",e)}catch(e){console.log("error",e)}};return(0,a.jsxs)(v.Provider,{value:t,children:[(0,a.jsxs)(S.A,{layout:"vertical",form:r,initialValues:I,children:[(0,a.jsx)(S.A.Item,{name:"1",label:"输入框1",rules:[{required:!0,message:"请输入"}],children:(0,a.jsx)(g.A,{})}),(0,a.jsx)(S.A.Item,{name:"a",label:"表格数据a",children:(0,a.jsx)(b,{name:"a"})}),(0,a.jsx)(S.A.Item,{name:"b",label:"表格数据b",children:(0,a.jsx)(b,{name:"b"})})]}),(0,a.jsx)(m.Ay,{type:"primary",onClick:i,children:"提交"})]})},{}))}},l={};function n(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return o[e](r,r.exports,n),r.exports}n.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(r,a){if(1&a&&(r=this(r)),8&a||"object"==typeof r&&r&&(4&a&&r.__esModule||16&a&&"function"==typeof r.then))return r;var i=Object.create(null);n.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>{s[e]=()=>r[e]});return s.default=()=>r,n.d(i,s),i},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r=[],n.O=(e,t,a,i)=>{if(t){i=i||0;for(var s=r.length;s>0&&r[s-1][2]>i;s--)r[s]=r[s-1];r[s]=[t,a,i];return}for(var o=1/0,s=0;s<r.length;s++){for(var[t,a,i]=r[s],l=!0,h=0;h<t.length;h++)(!1&i||o>=i)&&Object.keys(n.O).every(e=>n.O[e](t[h]))?t.splice(h--,1):(l=!1,i<o&&(o=i));if(l){r.splice(s--,1);var d=a();void 0!==d&&(e=d)}}return e},a={410:0},n.O.j=e=>0===a[e],i=(e,t)=>{var r,i,[s,o,l]=t,h=0;if(s.some(e=>0!==a[e])){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)var d=l(n)}for(e&&e(t);h<s.length;h++)i=s[h],n.o(a,i)&&a[i]&&a[i][0](),a[i]=0;return n.O(d)},(s=self.webpackChunkwebsite=self.webpackChunkwebsite||[]).forEach(i.bind(null,0)),s.push=i.bind(null,s.push.bind(s));var h=n.O(void 0,["783","290"],()=>n(956));h=n.O(h)})();